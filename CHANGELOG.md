# 📋 更新日志

本文档记录项目的所有重要更改。

---

## [v2.0.0] - 2025-09-30

### 🎉 重大更新

#### 用户隔离机制
- ✅ **新增用户隔离功能** - 每个用户只能查看和管理自己创建的数据
  - `tb_user` 表新增自增主键 `id`
  - `tb_task_info`、`tb_task_hqzljdjcjlb`、`tb_base_master` 表新增 `user_id` 字段
  - 前端登录时自动保存 `userId` 到 localStorage
  - 所有数据请求自动携带 `user_id` 参数进行过滤

#### 后端架构重构
- ✅ **MVC 架构重构** - 后端代码结构化重组
  - 创建 `config/` 目录：数据库和 CORS 配置
  - 创建 `models/` 目录：用户、任务、检查记录、人员模型
  - 创建 `controllers/` 目录：用户、认证、任务、检查记录控制器
  - `app.py` 简化为启动入口，只负责应用初始化和蓝图注册

#### 统一后端服务
- ✅ **单一入口启动** - 所有后端服务整合到 `app.py`
  - 移除独立的 `app_task.py`、`app_inspection.py`
  - 统一 API 端口为 5000
  - 前端 API 地址统一指向 `http://localhost:5000/api`

### 🚀 新增功能

#### 任务管理
- ✅ 任务创建/编辑/删除功能
- ✅ 任务搜索与重置
- ✅ 任务列表分页展示
- ✅ 创建任务时自动创建对应的航前检查记录
- ✅ 删除任务时自动删除对应的检查记录

#### 航前质量检查
- ✅ 航前质量监督检查记录表功能
- ✅ 11项检查内容的详细记录
- ✅ 检查记录编辑与保存
- ✅ 任务列表与检查记录的跳转逻辑
- ✅ 点击保存后自动返回任务列表

#### 用户认证
- ✅ 用户登录功能
- ✅ 用户注册功能
- ✅ 登录错误提示优化（"用户名或密码不正确"）
- ✅ 密码长度验证（至少6位）

#### 搜索功能
- ✅ 用户管理页面搜索与重置
- ✅ 任务管理页面搜索与重置
- ✅ 搜索无结果时的友好提示

### 🎨 UI/UX 优化

#### 任务管理页面美化
- ✅ 表格列宽调整，布局更协调
- ✅ 表格内容居中对齐，表头字体加粗
- ✅ 增加行高和单元格内边距
- ✅ 操作按钮横向排列，优化视觉效果
- ✅ 表单字段宽度调整，添加占位符提示

#### 检查记录页面优化
- ✅ 检查项标题优化 - 在大标题旁显示检查内容描述
- ✅ 取消按钮路由修复
- ✅ 保存后自动返回功能

#### 菜单结构优化
- ✅ 菜单项整合 - "航前质量监督检查记录表"并入"航前检查"
- ✅ 菜单文本更新 - "打开任务" → "航前质量监督检查记录表"

### 🐛 问题修复

#### 数据操作修复
- ✅ 修复用户编辑功能 - 用户名作为唯一标识，禁止编辑
- ✅ 修复用户删除功能 - 正确处理中文用户名的 URL 编码
- ✅ 修复任务新增功能 - 正确映射表单字段到数据库字段
- ✅ 修复检查记录路由 - 正确导入 API 方法

#### URL 编码修复
- ✅ 所有 PUT/DELETE 请求的 URL 参数使用 `encodeURIComponent` 编码
- ✅ 支持中文、特殊字符的正确传输

#### 数据库结构修复
- ✅ `tb_user` 表主键从 `name` 改为自增 `id`
- ✅ `name` 字段添加唯一索引
- ✅ 关键表添加 `user_id` 外键字段
- ✅ 现有数据的 `user_id` 批量更新为 3

### 📚 文档更新

#### 新增文档
- ✅ `数据库说明.md` - 完整的数据库结构说明
- ✅ `用户隔离功能说明.md` - 用户隔离实现详解
- ✅ `用户隔离功能实现总结.md` - 功能总结
- ✅ `前端用户隔离适配完成.md` - 前端适配说明
- ✅ `后端MVC重构说明.md` - 后端重构详解
- ✅ `MVC重构完成总结.md` - 重构总结
- ✅ `增删改查实现原理详解.md` - CRUD 教程（适合小白）
- ✅ `任务管理功能说明.md` - 任务管理文档
- ✅ `航前检查功能说明.md` - 航前检查文档
- ✅ `登录注册功能说明.md` - 登录注册文档
- ✅ `搜索功能说明.md` - 搜索功能文档

#### 问题修复文档
- ✅ `问题修复说明.md` - URL 编码和用户名编辑问题
- ✅ `新增任务修复说明.md` - 任务创建问题修复
- ✅ `检查记录页面跳转修复说明.md` - 页面跳转问题
- ✅ `检查项标题优化说明.md` - UI 优化说明
- ✅ `菜单整合说明.md` - 菜单结构调整
- ✅ `菜单和路由修复说明.md` - 路由问题修复

#### 快速开始文档
- ✅ `重构完成-快速开始.md` - 重构后的快速开始指南
- ✅ `统一后端启动说明.md` - 统一启动流程
- ✅ `启动说明.md` - 详细启动步骤

#### 文档整理
- ✅ 创建 `docs/` 目录，所有文档集中管理
- ✅ 更新 `README.md` - 添加项目徽章、完整功能清单、开发路线图

### 🔄 数据库更新

#### 新增数据库备份
- ✅ `marine_survey_db_latest.sql` - 包含用户隔离功能的完整备份
  - 10张表的完整结构
  - 初始测试数据
  - 用户隔离字段

#### 数据库迁移脚本
- ✅ `add_user_id_column.sql` - 用户隔离字段添加脚本
- ✅ `update_database_structure.py` - 自动化数据库结构更新
- ✅ `export_database.py` - 数据库导出工具

### 🛠️ 开发工具

#### 后端工具
- ✅ `check_user_tasks.py` - 检查用户任务关联
- ✅ `export_database.py` - 数据库导出工具

#### 已移除文件
- ❌ 移除 `app_task.py`、`app_inspection.py`（已整合）
- ❌ 移除 `models_task.py`、`models_inspection.py`（已重构）
- ❌ 移除 `routes_task.py`、`routes_inspection.py`（已重构）
- ❌ 移除 `test_api.py`、`test_register.py`（已完成测试）

---

## [v1.0.0] - 2025-09-29 及之前

### 初始功能
- ✅ Vue 3 + Vite 前端框架搭建
- ✅ Flask + MySQL 后端框架搭建
- ✅ 用户管理基础功能
- ✅ 基础人员管理功能
- ✅ SQLite 到 MySQL 数据库迁移
- ✅ 前后端 CORS 跨域配置
- ✅ Element Plus UI 集成

---

## 版本说明

### 版本号规则
- **主版本号（Major）**：不兼容的 API 修改
- **次版本号（Minor）**：向下兼容的功能性新增
- **修订号（Patch）**：向下兼容的问题修正

### 图标说明
- ✅ 新增功能
- 🐛 Bug 修复
- 🎨 UI/样式更新
- 🔄 重构/优化
- 📚 文档更新
- ❌ 移除功能
- ⚠️ 废弃警告

---

**最后更新时间**：2025-09-30  
**当前版本**：v2.0.0
