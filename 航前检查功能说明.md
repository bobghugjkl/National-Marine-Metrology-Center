# 航前质量监督检查记录表功能说明

## ✅ 已完成功能

### 1. 后端实现

#### 数据库表
- **表名**：`tb_task_hqzljdjcjlb`
- **主键**：`task_name`（任务名称）
- **字段**：
  - 基本信息：check_date, superintendent, superintended
  - 检查内容：check_1 ~ check_11（检查内容）
  - 存在问题：check_1_problem ~ check_11_problem
  - 补充说明：check_detail, check_result
  - 签名信息：chief_scientist_sign, check_leader_sign, chief_scientist_signdate, check_leader_signdate
  - 创建日期：create_date

#### 后端文件结构
```
backend/
├── models_inspection.py        # 检查记录数据模型
├── routes_inspection.py        # 检查记录API路由
├── app_inspection.py           # 检查记录后端服务（端口5002）
├── init_inspection_data.py     # 为现有任务创建空检查记录
└── routes_task.py              # 任务路由（已添加联动）
```

#### API 端点
**基础URL**: `http://localhost:5002/api`

1. **GET /inspections** - 获取所有检查记录
2. **GET /inspections/:task_name** - 获取指定任务的检查记录
3. **PUT /inspections/:task_name** - 更新检查记录
4. **POST /inspections** - 创建检查记录（自动）
5. **DELETE /inspections/:task_name** - 删除检查记录（自动）

#### 自动联动机制
- ✅ 创建任务时，自动创建空的检查记录
- ✅ 删除任务时，自动删除对应的检查记录
- ✅ 为所有现有任务创建了空检查记录

### 2. 前端实现

#### 前端文件结构
```
src/
├── api/
│   └── inspection.ts                                    # 检查记录API
├── views/
│   └── preVoyageInspection/
│       ├── inspection-task-list.vue                    # 任务列表页面
│       └── inspection-record.vue                        # 检查记录编辑页面
└── router/
    └── index.ts                                         # 路由配置（已修改）
```

#### 页面功能

##### 任务列表页面 (`inspection-task-list.vue`)
- 显示所有任务列表
- 点击任务或"查看检查记录"按钮跳转到检查记录页面
- 表格行可点击

##### 检查记录编辑页面 (`inspection-record.vue`)
- 显示任务基本信息
- 11个检查项，每项包含：
  - 检查内容输入框
  - 存在问题输入框
  - 状态标签（未填写/已完成/存在问题）
- 补充说明：检查详细说明、检查结果
- 签名信息：组长签字、任务负责人签字及日期
- 保存按钮
- 返回按钮

### 3. 路由配置

#### 修改的路由
- `/system-role` → 航前质量监督检查记录表（任务列表）
- `/inspection-record/:task_name` → 检查记录详情

原来的"角色管理"页面已被替换为"航前质量监督检查记录表"

---

## 🚀 启动说明

### 启动后端服务

需要启动**3个后端服务**：

```bash
# 1. 主后端（端口5000）- 用户、角色等
cd backend
python app.py

# 2. 任务管理后端（端口5001）
python app_task.py

# 3. 检查记录后端（端口5002）- 新增
python app_inspection.py
```

### 启动前端

```bash
npm run dev
```

---

## 📋 使用流程

### 1. 进入检查记录模块
- 登录系统
- 点击左侧菜单"角色管理"（已改为"航前质量监督检查记录表"）

### 2. 选择任务
- 在任务列表中查看所有任务
- 点击任务行或"查看检查记录"按钮

### 3. 填写检查记录
- 填写检查日期、监督单位等基本信息
- 填写11个检查项的内容和存在问题
- 填写补充说明（可选）
- 填写签名信息
- 点击"保存"按钮

### 4. 返回
- 点击"返回任务列表"或"取消"按钮返回

---

## 🔗 数据联动

### 创建任务时
1. 用户在任务管理中创建新任务
2. 后端自动为该任务创建空的检查记录
3. 用户可以立即进入检查记录页面填写

### 删除任务时
1. 用户在任务管理中删除任务
2. 后端自动删除该任务的检查记录
3. 确保数据一致性

---

## 🎨 页面特色

### 任务列表页面
- 清晰的标题和说明
- 美观的表格布局
- 行可点击（整行hover效果）
- 居中分页器

### 检查记录编辑页面
- 卡片式检查项布局
- 实时状态标签（未填写/已完成/存在问题）
- 分组显示（基本信息/检查内容/补充说明/签名确认）
- 清晰的视觉层次
- 响应式布局（12列栅格系统）

---

## 📊 数据示例

### 检查项内容
1. 是否有证了解航企安全方面、指定了替代性备选项
2. 调查人员是否持有上岗证或培训证明
3. 航次主管仪器设备是否齐备有效
4. 航次所用仪器设备是否都在检定后规定有效期
5. 航次所用仪器设备检定/校准/检测费
6. 不具备检定/校准/检测条件的仪器设备是否经过了相应的比对方法记录
7. 所使用检定等数据是否备齐
8. 船运记录单或质检显示是否按其标出有效期
9. 随船内质量新格是及见效记录
10. 所有工作日志、班组、监据记录提交组织交代并签字须知
11. 海员开展检验的器体、指定案签记录起点对长期照

---

## 🔧 技术栈

### 后端
- Flask（Python Web框架）
- Flask-SQLAlchemy（ORM）
- Flask-CORS（跨域支持）
- PyMySQL（MySQL驱动）
- MySQL数据库

### 前端
- Vue 3（组合式API）
- TypeScript
- Element Plus（UI组件库）
- Vue Router（路由管理）
- Axios（HTTP请求）

---

## 📝 注意事项

1. ✅ **task_name 不可修改**：作为主键，编辑时禁用
2. ✅ **自动创建记录**：创建任务时自动创建空检查记录
3. ✅ **自动删除记录**：删除任务时自动删除检查记录
4. ✅ **只支持编辑**：检查记录不支持手动新增或删除
5. ✅ **状态实时更新**：检查项状态标签根据填写情况实时变化

---

## 🎯 待优化功能（可选）

1. 添加表单验证（必填项检查）
2. 添加导出PDF功能
3. 添加历史记录查看
4. 添加批量导入/导出
5. 添加附件上传功能

---

## 🆘 常见问题

### 1. 后端启动失败
- 检查MySQL是否运行
- 检查端口5002是否被占用
- 检查数据库连接配置

### 2. 前端无法获取数据
- 检查后端服务是否全部启动（5000, 5001, 5002）
- 检查浏览器控制台是否有CORS错误
- 检查API baseURL配置

### 3. 保存失败
- 检查task_name是否正确
- 检查网络请求是否成功
- 查看后端日志

---

## ✨ 总结

航前质量监督检查记录表功能已完整实现，包括：
- ✅ 完整的后端API（独立端口5002）
- ✅ 美观的前端页面（任务列表+检查记录编辑）
- ✅ 自动联动机制（创建/删除任务时自动处理检查记录）
- ✅ 数据持久化（MySQL数据库）
- ✅ 路由配置（替换原角色管理页面）

**现在可以在前端使用此功能了！**
