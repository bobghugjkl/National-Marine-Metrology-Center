# 任务管理系统 - 数据库表说明

## 📊 使用的数据库

**数据库名称：** `marine_survey_db`（海洋调查数据库）

**数据库类型：** MySQL

**连接信息：**
- 主机：localhost
- 端口：3306
- 用户名：root
- 密码：WASDijkl15963

---

## 📋 数据库表列表

### 1. tb_task_info（任务信息表）✅ **当前使用**

**用途：** 存储航次任务的基本信息

**主键：** `task_name`（航次任务名称）

**表结构：**

| 字段名 | 数据类型 | 长度 | 是否必填 | 说明 | 示例 |
|--------|---------|------|---------|------|------|
| task_name | VARCHAR | 100 | ✅ | 航次任务名称（主键） | 东海海洋调查 |
| project | VARCHAR | 100 | ❌ | 专项名称 | 海洋资源调查专项 |
| task_code | VARCHAR | 100 | ❌ | 航次任务编号 | HY2025001 |
| undertake | VARCHAR | 100 | ❌ | 航次承担单位 | 国家海洋标准计量中心 |
| participant | VARCHAR | 200 | ❌ | 航次参与单位 | 中国海洋大学 |
| ship | VARCHAR | 45 | ❌ | 调查船 | 向阳红01 |
| leader | VARCHAR | 45 | ❌ | 任务负责人 | 张主任 |
| chief_scientist | VARCHAR | 45 | ❌ | 首席科学家 | 李教授 |
| superintendent | VARCHAR | 100 | ❌ | 随船监督员 | 王监督 |
| superintended | VARCHAR | 45 | ❌ | 随船监督 | - |
| executiontime | TEXT | - | ❌ | 执行时间 | 2025-01-15 至 2025-02-20 |
| subject | VARCHAR | 45 | ❌ | 任务学科 | 海洋地质 |

**创建语句：**
```sql
CREATE TABLE tb_task_info (
    task_name VARCHAR(100) NOT NULL PRIMARY KEY COMMENT '航次任务名称',
    project VARCHAR(100) COMMENT '专项名称',
    task_code VARCHAR(100) COMMENT '航次任务编号',
    undertake VARCHAR(100) COMMENT '航次承担单位',
    participant VARCHAR(200) COMMENT '航次参与单位',
    ship VARCHAR(45) COMMENT '调查船',
    leader VARCHAR(45) COMMENT '任务负责人',
    chief_scientist VARCHAR(45) COMMENT '首席科学家',
    superintendent VARCHAR(100) COMMENT '随船监督员',
    superintended VARCHAR(45) COMMENT '随船监督',
    executiontime TEXT COMMENT '执行时间',
    subject VARCHAR(45) COMMENT '任务学科'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='任务信息表';
```

**示例数据：**
```sql
INSERT INTO tb_task_info VALUES
('东海海洋调查', '海洋资源调查专项', 'HY2025001', '国家海洋标准计量中心', '', '向阳红01', '张主任', '', '', '', '2025-01-15 至 2025-02-20', '海洋地质'),
('南海深海探测', '深海科考专项', 'HY2025002', '中国海洋大学', '', '科学号', '李教授', '', '', '', '2025-03-01 至 2025-04-15', '海洋生物'),
('渤海环境监测', '海洋环境保护专项', 'HY2025003', '海洋环境监测中心', '', '海巡01', '王工程师', '', '', '', '2025-05-10 至 2025-06-20', '海洋化学');
```

---

### 2. tb_user（用户表）

**用途：** 存储系统用户信息，用于登录认证

**主键：** `name`（用户名）

**表结构：**

| 字段名 | 数据类型 | 长度 | 是否必填 | 说明 |
|--------|---------|------|---------|------|
| name | VARCHAR | 45 | ✅ | 用户名（主键） |
| login_name | VARCHAR | 45 | ❌ | 登录名 |
| password | VARCHAR | 45 | ❌ | 密码 |
| sex | VARCHAR | 45 | ❌ | 性别 |
| role | VARCHAR | 45 | ❌ | 角色 |
| desc | VARCHAR | 45 | ❌ | 描述 |
| permission | VARCHAR | 45 | ❌ | 权限 |
| department | VARCHAR | 255 | ❌ | 部门 |

---

### 3. tb_base_master（基础人员表）

**用途：** 存储基础人员信息

**主键：** `id_card_number`（身份证号）

**主要字段：**
- id_card_number - 身份证号
- name - 姓名
- gender - 性别
- birthday - 出生日期
- education - 学历
- major - 专业
- position - 职务
- unit - 单位

---

### 4. tb_base_hq_investigator（航前质检调查员表）

**用途：** 航前质量检查调查员信息

---

### 5. tb_base_hq_device（航前质检设备表）

**用途：** 航前质量检查设备信息

---

### 6. tb_task_hqzljdjcjlb（航前质量监督检查记录表）

**用途：** 航前质量监督检查记录

---

### 7. tb_base_hz_investigator（航中调查员表）

**用途：** 航中调查员信息

---

### 8. tb_base_hz_device（航中设备表）

**用途：** 航中设备信息

---

### 9. tb_task_sczljdjcb（现场质量监督检查表）

**用途：** 现场质量监督检查记录

---

### 10. tb_task_zlpgb（质量评估表）

**用途：** 质量评估信息

---

## 🔗 表关系说明

### 当前任务管理系统使用的表关系

```
tb_task_info（任务信息表）
    ↓
    主键：task_name
    ↓
    关联到其他表（通过 task_name）
```

**关联关系：**
1. `tb_task_info` 是核心表，存储任务基本信息
2. 其他表通过 `task_name` 字段与任务表关联
3. 用户表 `tb_user` 独立存储，用于登录认证

---

## 📍 当前系统使用情况

### 任务管理模块

**使用的表：** `tb_task_info`

**后端服务：** 
- 端口：5001
- 文件：`backend/app_task.py`

**前端页面：**
- 路径：`/system-user`
- 组件：`src/views/VoyageInfo/task-manage.vue`

**API 接口：**
- GET `/api/tasks` - 获取任务列表（支持搜索）
- POST `/api/tasks` - 创建新任务
- PUT `/api/tasks/:task_name` - 更新任务
- DELETE `/api/tasks/:task_name` - 删除任务

### 用户管理模块

**使用的表：** `tb_user`

**后端服务：**
- 端口：5000
- 文件：`backend/app.py`

**API 接口：**
- POST `/api/login` - 用户登录
- POST `/api/register` - 用户注册
- GET `/api/users` - 获取用户列表
- POST `/api/users` - 创建用户
- PUT `/api/users/:name` - 更新用户
- DELETE `/api/users/:name` - 删除用户

---

## 🔍 查询当前数据

### 查看任务数据
```sql
-- 查看所有任务
SELECT * FROM tb_task_info;

-- 查看任务数量
SELECT COUNT(*) FROM tb_task_info;

-- 按名称搜索任务
SELECT * FROM tb_task_info WHERE task_name LIKE '%东海%';
```

### 查看用户数据
```sql
-- 查看所有用户
SELECT * FROM tb_user;

-- 查看用户数量
SELECT COUNT(*) FROM tb_user;

-- 按用户名搜索
SELECT * FROM tb_user WHERE name LIKE '%admin%';
```

---

## 📝 数据字典

### 任务学科（subject）常用值
- 海洋地质
- 海洋生物
- 海洋化学
- 海洋物理
- 海洋环境

### 调查船（ship）示例
- 向阳红01
- 科学号
- 海巡01
- 大洋一号
- 蛟龙号

### 单位（undertake）示例
- 国家海洋标准计量中心
- 中国海洋大学
- 海洋环境监测中心
- 国家海洋局

---

## 🛠️ 数据库操作

### 连接数据库
```bash
mysql -h localhost -u root -p
# 输入密码：WASDijkl15963

USE marine_survey_db;
```

### 备份数据
```bash
mysqldump -u root -p marine_survey_db > backup.sql
```

### 恢复数据
```bash
mysql -u root -p marine_survey_db < backup.sql
```

---

## ✅ 总结

**当前任务管理页面使用：**
- 📊 **数据库**：`marine_survey_db`
- 📋 **表名**：`tb_task_info`
- 🔑 **主键**：`task_name`（航次任务名称）
- 📝 **字段数**：12 个
- 📦 **数据条数**：5 条（初始数据）

**美化改进：**
1. ✅ 表格列宽度优化
2. ✅ 操作列固定在右侧
3. ✅ 所有输入框添加占位符提示
4. ✅ 表单布局更美观
5. ✅ 搜索框添加提示文字
