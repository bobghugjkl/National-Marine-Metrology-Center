# æ–°å¢ä»»åŠ¡ä¿®å¤è¯´æ˜

## ğŸ› é—®é¢˜æè¿°

ç”¨æˆ·åé¦ˆï¼š"æˆ‘ç°åœ¨ä¸ºä»€ä¹ˆåˆæ–°å¢ä¸äº†ä»»åŠ¡äº†"

æµè§ˆå™¨æ§åˆ¶å°æ˜¾ç¤ºå¤šä¸ª 500 é”™è¯¯ï¼ˆINTERNAL SERVER ERRORï¼‰ã€‚

## ğŸ” é—®é¢˜åˆ†æ

### é”™è¯¯ä¿¡æ¯
```
'start_date' is an invalid keyword argument for TaskInfo
```

### æ ¹æœ¬åŸå› 
åœ¨ `backend/app.py` çš„ `create_task` å‡½æ•°ä¸­ï¼ˆç¬¬345-346è¡Œï¼‰ï¼Œå°è¯•ä½¿ç”¨äº† `start_date` å’Œ `end_date` å­—æ®µåˆ›å»ºä»»åŠ¡ï¼š

```python
new_task = TaskInfo(
    task_name=data.get('task_name'),
    project=data.get('project'),
    task_code=data.get('task_code'),
    undertake=data.get('undertake'),
    leader=data.get('leader'),
    ship=data.get('ship'),
    start_date=data.get('start_date'),  # âŒ é”™è¯¯ï¼šTaskInfo æ¨¡å‹ä¸­æ²¡æœ‰æ­¤å­—æ®µ
    end_date=data.get('end_date')       # âŒ é”™è¯¯ï¼šTaskInfo æ¨¡å‹ä¸­æ²¡æœ‰æ­¤å­—æ®µ
)
```

ä½†æ˜¯ `TaskInfo` æ¨¡å‹å®šä¹‰ä¸­ï¼ˆç¬¬58-90è¡Œï¼‰å®é™…çš„å­—æ®µæ˜¯ï¼š
- task_name
- project
- task_code
- undertake
- **participant** ï¼ˆå‚ä¸å•ä½ï¼‰
- ship
- leader
- chief_scientist
- superintendent
- superintended
- **executiontime** ï¼ˆæ‰§è¡Œæ—¶é—´ï¼Œè€Œä¸æ˜¯ start_date/end_dateï¼‰
- subject

## âœ… ä¿®å¤æ–¹æ¡ˆ

### å·²ä¿®å¤ä»£ç 

**æ–‡ä»¶**ï¼š`backend/app.py` ç¬¬334-351è¡Œ

```python
@app.route('/api/tasks', methods=['POST'])
def create_task():
    try:
        data = request.json
        new_task = TaskInfo(
            task_name=data.get('task_name'),
            project=data.get('project'),
            task_code=data.get('task_code'),
            undertake=data.get('undertake'),
            participant=data.get('participant'),           # âœ… æ–°å¢
            ship=data.get('ship'),
            leader=data.get('leader'),
            chief_scientist=data.get('chief_scientist'),   # âœ… æ–°å¢
            superintendent=data.get('superintendent'),     # âœ… æ–°å¢
            superintended=data.get('superintended'),       # âœ… æ–°å¢
            executiontime=data.get('executiontime'),       # âœ… æ–°å¢ï¼ˆæ›¿ä»£ start_date/end_dateï¼‰
            subject=data.get('subject')                    # âœ… æ–°å¢
        )
        db.session.add(new_task)
        db.session.commit()
        
        # è‡ªåŠ¨åˆ›å»ºå¯¹åº”çš„æ£€æŸ¥è®°å½•
        try:
            new_inspection = PreVoyageInspection(task_name=data.get('task_name'))
            db.session.add(new_inspection)
            db.session.commit()
        except Exception as e:
            print(f'åˆ›å»ºæ£€æŸ¥è®°å½•å¤±è´¥: {e}')
        
        return jsonify({
            'code': 200,
            'message': 'åˆ›å»ºæˆåŠŸ',
            'data': new_task.to_dict()
        })
    except Exception as e:
        db.session.rollback()
        return jsonify({'code': 500, 'message': str(e)}), 500
```

## ğŸš€ å¦‚ä½•åº”ç”¨ä¿®å¤

### æ–¹æ³•ä¸€ï¼šé‡å¯åç«¯ï¼ˆæ¨èï¼‰

1. **åœæ­¢å½“å‰åç«¯**
   - åœ¨è¿è¡Œ `python app.py` çš„ç»ˆç«¯æŒ‰ `Ctrl+C`

2. **é‡æ–°å¯åŠ¨åç«¯**
   ```bash
   cd backend
   python app.py
   ```

3. **éªŒè¯å¯åŠ¨æˆåŠŸ**
   - åº”è¯¥çœ‹åˆ°ï¼š`ç»Ÿä¸€åç«¯æœåŠ¡å·²å¯åŠ¨: http://localhost:5000`

### æ–¹æ³•äºŒï¼šå¼ºåˆ¶é‡è½½

å¦‚æœFlaskæ²¡æœ‰è‡ªåŠ¨é‡è½½ï¼Œå¯ä»¥ï¼š

1. **ä¿®æ”¹ app.py æ·»åŠ ä¸€ä¸ªç©ºè¡Œ**ï¼ˆè§¦å‘æ–‡ä»¶å˜åŒ–ï¼‰
2. **ä¿å­˜æ–‡ä»¶**
3. **è§‚å¯Ÿç»ˆç«¯**ï¼Œåº”è¯¥çœ‹åˆ° "Detected change" å’Œ "Restarting"

## âœ… éªŒè¯æ­¥éª¤

### 1. æµ‹è¯•åç«¯APIï¼ˆå¯é€‰ï¼‰

```bash
# åœ¨å‘½ä»¤è¡Œæµ‹è¯•
python -c "import requests; import json; data={'task_name':'æµ‹è¯•ä»»åŠ¡001','project':'æµ‹è¯•ä¸“é¡¹','undertake':'æµ‹è¯•å•ä½','leader':'å¼ ä¸‰'}; r=requests.post('http://localhost:5000/api/tasks', json=data); print(f'Status: {r.status_code}'); print(f'Response: {r.json()}')"
```

åº”è¯¥çœ‹åˆ°ï¼š
```
Status: 200
Response: {'code': 200, 'message': 'åˆ›å»ºæˆåŠŸ', 'data': {...}}
```

### 2. åœ¨å‰ç«¯æµ‹è¯•

1. **åˆ·æ–°æµè§ˆå™¨**
2. **è¿›å…¥ä»»åŠ¡ç®¡ç†**
   - ç‚¹å‡»"ä»»åŠ¡ç®¡ç†" â†’ "æ–°å»ºä»»åŠ¡"
3. **å¡«å†™è¡¨å•**
   - èˆªæ¬¡ä»»åŠ¡åç§°ï¼šQQQ
   - ä¸“é¡¹åç§°ï¼š111
   - èˆªæ¬¡ä»»åŠ¡ç¼–å·ï¼š111
   - ç­‰ç­‰...
4. **ç‚¹å‡»ä¿å­˜**
   - åº”è¯¥æˆåŠŸåˆ›å»ºï¼Œä¸å†æŠ¥ 500 é”™è¯¯

## ğŸ“Š å­—æ®µå¯¹åº”å…³ç³»

| å‰ç«¯è¡¨å•å­—æ®µ | åç«¯æ•°æ®åº“å­—æ®µ | è¯´æ˜ |
|-------------|---------------|------|
| èˆªæ¬¡ä»»åŠ¡åç§° | task_name | ä¸»é”®ï¼Œå¿…å¡« |
| ä¸“é¡¹åç§° | project | å¯é€‰ |
| èˆªæ¬¡ä»»åŠ¡ç¼–å· | task_code | å¯é€‰ |
| èˆªæ¬¡æ‰¿æ‹…å•ä½ | undertake | å¯é€‰ |
| èˆªæ¬¡å‚ä¸å•ä½ | participant | å¯é€‰ |
| è°ƒæŸ¥èˆ¹ | ship | å¯é€‰ |
| ä»»åŠ¡è´Ÿè´£äºº | leader | å¯é€‰ |
| é¦–å¸­ç§‘å­¦å®¶ | chief_scientist | å¯é€‰ |
| éšèˆ¹ç›‘ç£å‘˜ | superintendent | å¯é€‰ |
| éšèˆ¹ç›‘ç£ | superintended | å¯é€‰ |
| æ‰§è¡Œæ—¶é—´ | executiontime | å¯é€‰ï¼Œæ›¿ä»£äº† start_date/end_date |
| ä»»åŠ¡å­¦ç§‘ | subject | å¯é€‰ |

## ğŸ”§ æŠ€æœ¯è¯´æ˜

### ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ä¸ªé—®é¢˜ï¼Ÿ

1. **æ¨¡å‹å®šä¹‰å’Œä½¿ç”¨ä¸åŒ¹é…**
   - `TaskInfo` æ¨¡å‹ä¸­ä½¿ç”¨ `executiontime` å­—æ®µå­˜å‚¨æ‰§è¡Œæ—¶é—´
   - ä½†åˆ›å»ºä»»åŠ¡æ—¶é”™è¯¯åœ°ä½¿ç”¨äº† `start_date` å’Œ `end_date`

2. **SQLAlchemy ä¸¥æ ¼æ£€æŸ¥**
   - SQLAlchemy ä¼šéªŒè¯ä¼ å…¥çš„å‚æ•°æ˜¯å¦æ˜¯æ¨¡å‹çš„æœ‰æ•ˆå­—æ®µ
   - å¦‚æœå­—æ®µä¸å­˜åœ¨ï¼Œä¼šæŠ›å‡º `invalid keyword argument` é”™è¯¯

### ä¸ºä»€ä¹ˆ Flask æ²¡æœ‰è‡ªåŠ¨é‡è½½ï¼Ÿ

å¯èƒ½çš„åŸå› ï¼š
1. **æ–‡ä»¶ä¿å­˜é—®é¢˜**ï¼šIDEå¯èƒ½æ²¡æœ‰çœŸæ­£ä¿å­˜æ–‡ä»¶åˆ°ç£ç›˜
2. **ç¼“å­˜é—®é¢˜**ï¼šPython å­—èŠ‚ç ç¼“å­˜ï¼ˆ`.pyc` æ–‡ä»¶ï¼‰å¯èƒ½éœ€è¦æ¸…é™¤
3. **debugæ¨¡å¼é—®é¢˜**ï¼šè™½ç„¶ `debug=True`ï¼Œä½†æŸäº›æƒ…å†µä¸‹éœ€è¦æ‰‹åŠ¨é‡å¯

## ğŸ“ æ€»ç»“

- âœ… **é—®é¢˜**ï¼šåˆ›å»ºä»»åŠ¡æ—¶ä½¿ç”¨äº†ä¸å­˜åœ¨çš„ `start_date`/`end_date` å­—æ®µ
- âœ… **ä¿®å¤**ï¼šä½¿ç”¨æ­£ç¡®çš„å­—æ®µåç§°ï¼ˆ`executiontime`, `participant`, `chief_scientist` ç­‰ï¼‰
- âœ… **æ“ä½œ**ï¼šé‡å¯åç«¯æœåŠ¡ï¼ˆ`Ctrl+C` ç„¶å `python app.py`ï¼‰
- âœ… **éªŒè¯**ï¼šåœ¨å‰ç«¯æ–°å»ºä»»åŠ¡åº”è¯¥æˆåŠŸ

---

**ä¿®å¤å®Œæˆæ—¶é—´**ï¼š2025å¹´9æœˆ30æ—¥  
**å½±å“åŠŸèƒ½**ï¼šä»»åŠ¡åˆ›å»ºï¼ˆPOST /api/tasksï¼‰  
**çŠ¶æ€**ï¼šâœ… å·²ä¿®å¤ï¼Œéœ€é‡å¯åç«¯
