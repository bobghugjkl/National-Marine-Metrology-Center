# 用户管理功能说明

## ✅ 已完成功能

### 1. 用户列表展示
- ✅ 从 MySQL 数据库实时获取用户数据
- ✅ 显示用户名、登录名、部门、角色等信息
- ✅ 支持分页显示（显示总数）

### 2. 新增用户
- ✅ 点击"新增"按钮打开表单
- ✅ 必填字段验证
- ✅ 成功后刷新列表
- ✅ 数据保存到 MySQL 数据库

### 3. 编辑用户
- ✅ 点击"编辑"按钮打开表单
- ✅ 用户名字段自动禁用（主键不可修改）
- ✅ 密码字段非必填（编辑时可选）
- ✅ 支持修改登录名、性别、角色、部门等
- ✅ 更新成功后刷新列表
- ✅ 数据更新到 MySQL 数据库

### 4. 删除用户
- ✅ 点击"删除"按钮
- ✅ 弹出确认对话框
- ✅ 确认后从数据库删除
- ✅ 删除成功后刷新列表

### 5. CORS 支持
- ✅ 后端配置完整的 CORS 支持
- ✅ 允许 GET、POST、PUT、DELETE、OPTIONS 方法
- ✅ 前端可以正常跨域请求

## 📋 表单字段说明

### 新增用户表单
| 字段 | 标签 | 是否必填 | 说明 |
|------|------|---------|------|
| name | 用户名 | ✅ 是 | 主键，唯一标识 |
| login_name | 登录名 | ✅ 是 | 登录账号 |
| password | 密码 | ✅ 是 | 登录密码 |
| sex | 性别 | ❌ 否 | 性别信息 |
| role | 角色 | ✅ 是 | 用户角色 |
| department | 部门 | ✅ 是 | 所属部门 |

### 编辑用户表单
| 字段 | 标签 | 是否必填 | 说明 |
|------|------|---------|------|
| name | 用户名 | ✅ 是 | **已禁用**，不可修改（主键） |
| login_name | 登录名 | ✅ 是 | 可修改 |
| password | 密码 | ❌ 否 | 可选修改 |
| sex | 性别 | ❌ 否 | 可修改 |
| role | 角色 | ✅ 是 | 可修改 |
| department | 部门 | ✅ 是 | 可修改 |

## 🔧 技术实现

### 前端 (`src/views/system/user.vue`)

1. **导入 API 函数**
```typescript
import { fetchUserData, createUser, updateUser, deleteUser } from '@/api';
```

2. **动态表单配置**
```typescript
const options = computed<FormOption>(() => ({
    labelWidth: '100px',
    span: 12,
    list: [
        { type: 'input', label: '用户名', prop: 'name', required: true, disabled: isEdit.value },
        { type: 'input', label: '登录名', prop: 'login_name', required: true },
        { type: 'input', label: '密码', prop: 'password', required: !isEdit.value },
        { type: 'input', label: '性别', prop: 'sex' },
        { type: 'input', label: '角色', prop: 'role', required: true },
        { type: 'input', label: '部门', prop: 'department', required: true },
    ]
}))
```

3. **新增/编辑处理**
```typescript
const updateData = async (formData: any) => {
    if (isEdit.value) {
        await updateUser(formData.name, formData);  // PUT /api/users/{name}
    } else {
        await createUser(formData);  // POST /api/users
    }
    getData();
};
```

4. **删除处理**
```typescript
const handleDelete = async (row: User) => {
    await ElMessageBox.confirm('确定要删除该用户吗？');
    await deleteUser(row.name);  // DELETE /api/users/{name}
    getData();
};
```

### 后端 (`backend/app.py`)

1. **CORS 配置**
```python
CORS(app, resources={
    r"/api/*": {
        "origins": "*",
        "methods": ["GET", "POST", "PUT", "DELETE", "OPTIONS"],
        "allow_headers": ["Content-Type"]
    }
})
```

2. **统一返回格式**
```python
{
    "code": 200,
    "data": {
        "list": [...],
        "pageTotal": 数量
    }
}
```

3. **API 端点**
- `GET /api/users` - 获取用户列表
- `POST /api/users` - 创建用户
- `PUT /api/users/{name}` - 更新用户
- `DELETE /api/users/{name}` - 删除用户

## 🎯 测试验证

### 测试 1：获取用户列表
```bash
curl http://localhost:5000/api/users
```

### 测试 2：创建用户
```bash
curl -X POST http://localhost:5000/api/users \
  -H "Content-Type: application/json" \
  -d '{"name":"newuser","login_name":"newlogin","password":"123","role":"user","department":"IT"}'
```

### 测试 3：更新用户
```bash
curl -X PUT http://localhost:5000/api/users/admin \
  -H "Content-Type: application/json" \
  -d '{"role":"super_admin","department":"IT_Department"}'
```

### 测试 4：删除用户
```bash
curl -X DELETE http://localhost:5000/api/users/newuser
```

## 📊 数据库表结构

**表名：`tb_user`**

| 字段 | 类型 | 说明 | 约束 |
|------|------|------|------|
| name | VARCHAR(45) | 用户名 | PRIMARY KEY |
| login_name | VARCHAR(45) | 登录名 | - |
| password | VARCHAR(45) | 密码 | - |
| sex | VARCHAR(45) | 性别 | - |
| role | VARCHAR(45) | 角色 | - |
| desc | VARCHAR(45) | 描述 | - |
| permission | VARCHAR(45) | 权限 | - |
| department | VARCHAR(255) | 部门 | NOT NULL |

## 🚀 使用说明

1. **启动后端**
```bash
cd backend
python app.py
```
后端运行在：http://localhost:5000

2. **启动前端**
```bash
npm run dev
```
前端运行在：http://localhost:5173

3. **访问用户管理页面**
- 打开浏览器访问：http://localhost:5173
- 登录系统
- 进入"系统管理" -> "用户管理"

4. **操作步骤**
- **新增**：点击"新增"按钮 → 填写表单 → 保存
- **编辑**：点击"编辑"按钮 → 修改字段（用户名不可改）→ 保存
- **删除**：点击"删除"按钮 → 确认 → 完成

## ⚠️ 注意事项

1. **用户名是主键**
   - 新增时必须唯一
   - 编辑时不可修改（自动禁用）

2. **密码字段**
   - 新增时必填
   - 编辑时可选（不填则保持原密码）

3. **CORS 配置**
   - 已配置允许所有来源
   - 生产环境建议限制具体域名

4. **数据验证**
   - 前端有基本验证
   - 后端建议添加更多验证逻辑

## ✨ 下一步优化建议

1. **密码加密**：添加密码 hash 存储
2. **权限控制**：根据角色限制操作权限
3. **搜索功能**：实现按用户名搜索
4. **分页优化**：后端实现真实分页
5. **错误处理**：更详细的错误提示
