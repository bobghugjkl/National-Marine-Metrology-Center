# 🔬 外业调查项目管理前端页面使用说明

## 📋 功能概述

本页面实现了外业调查项目/仪器比测统计表的前端展示和管理功能，包括：

- 📊 调查项目列表展示（带分页）
- ➕ 新增调查项目记录
- ✏️ 编辑已有调查项目信息
- 🔍 按条件搜索调查项目
- 🗑️ 删除和批量删除功能
- 📥 Excel模板下载和文件导入
- 📎 附件上传和管理
- 👁️ 调查项目详情查看

## 🖥️ 界面预览

页面布局包含：
- **顶部标题栏**：显示"外业调查项目/仪器比测统计表"，右侧放置操作按钮
- **搜索区域**：支持按航次任务、调查项目、比测仪器、地点筛选
- **数据表格**：展示调查项目信息，支持排序、分页等操作，比测结果状态颜色提示
- **弹窗表单**：新增/编辑调查项目信息的表单

## 🎨 特色功能

### 📊 比测结果状态显示
- 🟢 **一致**：两单位仪器测量结果完全一致
- 🟡 **基本一致**：测量结果基本吻合，存在微小差异
- 🔴 **差异较大**：测量结果存在明显差异
- 🔵 **需要进一步验证**：结果需要额外验证确认

### 📋 表格列说明
| 列名 | 说明 | 特殊功能 |
|------|------|----------|
| 航次任务名称 | 所属海洋调查任务 | - |
| 调查项目/仪器 | 调查项目或仪器名称 | 彩色标签显示 |
| 比测单位甲仪器 | 甲方参与比测的仪器 | - |
| 比测单位乙仪器 | 乙方参与比测的仪器 | - |
| 比测时间 | 仪器比测的具体时间 | 日期时间格式 |
| 比测地点 | 进行比测的地点 | - |
| 比测结果 | 比测结果评价 | 状态颜色标签 |
| 备注 | 附加说明信息 | - |
| 附件 | 相关文档 | 点击查看/下载 |

## 🔌 后端API接口要求

为了让前端页面正常工作，后端需要实现以下RESTful API接口：

### 基础CRUD接口

```javascript
// 1. 获取调查项目列表（支持分页和搜索）
GET /api/investigation-projects
Query参数：
- page: 页码 (默认1)
- pageSize: 每页数量 (默认10)
- task_name: 航次任务名称（可选）
- investigation_item: 调查项目（可选）
- unit_a_equipment: 比测单位甲仪器（可选）
- unit_b_equipment: 比测单位乙仪器（可选）
- comparison_location: 比测地点（可选）

响应格式：
{
  "code": 200,
  "data": {
    "list": [
      {
        "id": 1,
        "task_name": "2024年春季海洋调查",
        "investigation_item": "CTD温盐深测量",
        "unit_a_equipment": "SBE-911plus",
        "unit_b_equipment": "RBR-CTD",
        "comparison_time": "2024-01-15 14:30:00",
        "comparison_location": "青岛海洋站实验室",
        "comparison_result": "一致",
        "remarks": "比测结果良好，数据一致性高",
        "attachments": [
          {
            "id": 1,
            "name": "比测报告.pdf",
            "url": "/uploads/comparison/比测报告.pdf"
          }
        ],
        "create_time": "2024-01-15T10:30:00Z",
        "update_time": "2024-01-15T10:30:00Z"
      }
    ],
    "total": 100,
    "page": 1,
    "pageSize": 10
  }
}

// 2. 创建调查项目记录
POST /api/investigation-projects
请求体：
{
  "task_name": "2024年春季海洋调查",
  "investigation_item": "CTD温盐深测量",
  "unit_a_equipment": "SBE-911plus",
  "unit_b_equipment": "RBR-CTD",
  "comparison_time": "2024-01-15 14:30:00",
  "comparison_location": "青岛海洋站实验室",
  "comparison_result": "一致",
  "remarks": "比测结果良好，数据一致性高",
  "attachments": [
    {
      "id": 1,
      "name": "比测报告.pdf",
      "url": "/uploads/comparison/比测报告.pdf"
    }
  ]
}

// 3. 更新调查项目记录
PUT /api/investigation-projects/{id}
Path参数：id（调查项目记录ID）
请求体：同创建接口

// 4. 删除调查项目记录
DELETE /api/investigation-projects/{id}
Path参数：id（调查项目记录ID）

// 5. 批量删除调查项目记录
POST /api/investigation-projects/batch-delete
请求体：
{
  "ids": [1, 2, 3, 4, 5]  // 要删除的调查项目ID数组
}

// 6. 获取单个调查项目详情
GET /api/investigation-projects/{id}
Path参数：id（调查项目记录ID）
```

### 文件操作接口

```javascript
// 7. 下载Excel模板
GET /api/investigation-projects/template
响应：Excel文件流

// 8. 导入Excel文件
POST /api/investigation-projects/import
Content-Type: multipart/form-data
请求体：FormData，包含file字段（Excel文件）

响应格式：
{
  "code": 200,
  "data": {
    "imported_count": 15,  // 成功导入的记录数
    "failed_count": 2,    // 导入失败的记录数
    "errors": []          // 错误详情（如果有的话）
  }
}

// 9. 导出调查项目数据
GET /api/investigation-projects/export
Query参数：（可选，支持筛选条件）
响应：Excel文件流

// 10. 上传附件文件
POST /api/investigation-projects/upload
Content-Type: multipart/form-data
请求体：FormData，包含file字段（附件文件）

响应格式：
{
  "code": 200,
  "data": {
    "id": 1,
    "name": "比测报告.pdf",
    "url": "/uploads/comparison/比测报告.pdf"
  }
}

// 11. 获取调查项目类型选项（可选）
GET /api/investigation-projects/types
响应：
{
  "code": 200,
  "data": [
    "CTD温盐深测量",
    "多参数水质监测",
    "沉积物采样分析",
    "海洋气象观测",
    "海流观测",
    "其他"
  ]
}

// 12. 获取比测单位选项（可选）
GET /api/investigation-projects/comparison-units
响应：
{
  "code": 200,
  "data": [
    "国家海洋技术中心",
    "青岛海洋地质研究所",
    "上海海洋大学",
    "厦门大学海洋系",
    "其他单位"
  ]
}
```

## 📊 数据表结构建议

后端数据库中建议创建如下表结构：

```sql
CREATE TABLE investigation_projects (
    id INT PRIMARY KEY AUTO_INCREMENT COMMENT '主键ID',
    task_name VARCHAR(255) NOT NULL COMMENT '航次任务名称',
    investigation_item VARCHAR(255) NOT NULL COMMENT '调查项目/仪器',
    unit_a_equipment VARCHAR(255) NOT NULL COMMENT '比测单位甲仪器',
    unit_b_equipment VARCHAR(255) NOT NULL COMMENT '比测单位乙仪器',
    comparison_time DATETIME NOT NULL COMMENT '比测时间',
    comparison_location VARCHAR(255) NOT NULL COMMENT '比测地点',
    comparison_result VARCHAR(50) NOT NULL COMMENT '比测结果',
    remarks TEXT COMMENT '备注',
    attachments JSON COMMENT '附件信息（JSON数组）',
    user_id INT COMMENT '创建用户ID（用户隔离）',
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    update_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    INDEX idx_task_name (task_name),
    INDEX idx_investigation_item (investigation_item),
    INDEX idx_comparison_time (comparison_time),
    INDEX idx_comparison_result (comparison_result)
) COMMENT '外业调查项目表';
```

## 🔐 权限控制

建议在后端实现用户隔离机制：
- 每个用户只能查看/编辑自己创建的调查项目记录
- 在查询接口中自动过滤 `user_id` 字段
- 支持管理员查看所有记录

## ⚠️ 注意事项

1. **用户隔离**：前端会自动携带 `user_id` 参数，后端需要根据此参数过滤数据
2. **文件上传**：附件上传需要实现文件存储和访问控制
3. **数据验证**：后端需要对所有必填字段进行验证，特别是比测时间格式
4. **结果统计**：可以根据比测结果生成统计报告
5. **错误处理**：建议实现统一的错误处理和日志记录
6. **性能优化**：大量数据时需要考虑分页和索引优化

## 🚀 部署说明

1. 确保后端API接口按上述规范实现
2. 配置正确的API基础地址（目前默认为 `http://localhost:5000/api`）
3. 实现文件上传和存储功能
4. 设置适当的CORS策略允许前端访问
5. 考虑添加比测结果统计分析功能

## 📈 扩展建议

1. **比测趋势分析**：统计不同时间段的比测一致性
2. **仪器性能评估**：基于比测结果评估仪器性能
3. **结果可视化**：图表展示比测结果统计
4. **提醒功能**：定期比测提醒和到期提醒
5. **报告生成**：自动生成比测报告

按照以上规范实现后端接口，前端页面就可以正常工作了！

## 🔗 相关链接

- [人员资质管理](./外业调查人员资质管理.md)
- [设备管理](./外业设备管理.md)
