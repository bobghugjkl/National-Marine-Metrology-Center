# 用户隔离调试指南

## 🔍 立即诊断问题

### 步骤1: 检查 localStorage

在浏览器按 **F12** 打开控制台，粘贴以下代码并回车：

```javascript
console.log('=== 用户隔离诊断 ===');
console.log('userId:', localStorage.getItem('userId'));
console.log('username:', localStorage.getItem('vuems_name'));
console.log('所有 localStorage:');
for (let i = 0; i < localStorage.length; i++) {
    const key = localStorage.key(i);
    console.log(`  ${key}: ${localStorage.getItem(key)}`);
}
```

**预期结果**：
- 如果有 `userId: 12` → 继续步骤2
- 如果 `userId: null` → **你还没重新登录！** 请先退出登录，重新登录

---

### 步骤2: 检查 API 请求

在 F12 → **Network** 标签 → 刷新任务管理页面，找到 `/api/tasks` 请求，粘贴以下代码：

```javascript
// 模拟前端请求
fetch('http://localhost:5000/api/tasks?user_id=' + localStorage.getItem('userId'))
    .then(res => res.json())
    .then(data => {
        console.log('=== API 返回数据 ===');
        console.log('返回任务数:', data.data.list.length);
        console.log('任务列表:', data.data.list);
    });
```

**预期结果**：
- user_id=12 → 返回 0 条任务
- 如果返回 5 条任务 → 说明请求**没有携带 user_id**

---

### 步骤3: 强制重新登录

**立即执行以下操作**：

1. **清除所有 localStorage**（控制台执行）：
```javascript
localStorage.clear();
console.log('已清除所有 localStorage');
```

2. **刷新页面**（会跳转到登录页）

3. **重新登录用户 1234**

4. **登录后立即检查**（控制台执行）：
```javascript
console.log('userId:', localStorage.getItem('userId'));
// 应该显示: userId: 12
```

5. **再次访问任务管理**

---

## 🐛 如果还是不行

如果执行上述步骤后还是能看到所有任务，说明前端代码有问题。

### 临时解决方案：手动修改

在浏览器控制台执行以下代码，**手动覆盖 getData 函数**：

```javascript
// 这段代码会临时修复用户隔离问题
console.log('正在修复用户隔离...');

// 拦截所有请求，自动添加 user_id
const originalFetch = window.fetch;
window.fetch = function(...args) {
    let [url, options] = args;
    const userId = localStorage.getItem('userId');
    
    if (url.includes('/api/tasks') && userId) {
        if (url.includes('?')) {
            url += `&user_id=${userId}`;
        } else {
            url += `?user_id=${userId}`;
        }
        args[0] = url;
        console.log('已自动添加 user_id:', url);
    }
    
    return originalFetch.apply(this, args);
};

console.log('修复完成！刷新页面查看效果。');
```

执行后刷新页面，应该就只能看到自己的任务了。

---

## 📋 永久修复方案

如果临时方案有效，说明前端代码确实有问题。我需要你提供以下信息：

1. **Network 标签中 `/api/tasks` 请求的完整 URL**
2. **localStorage 中 `userId` 的值**

然后我会修改前端代码，永久修复这个问题。

---

## ⚡ 快速验证

最快的验证方法：

```javascript
// 控制台执行
localStorage.setItem('userId', '12');  // 手动设置用户ID
location.reload();  // 刷新页面
```

刷新后，如果任务列表变空了，说明代码逻辑没问题，只是 localStorage 没有 userId。
如果还是显示 5 条任务，说明前端代码根本没有读取 userId。
