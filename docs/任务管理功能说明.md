# ä»»åŠ¡ç®¡ç†åŠŸèƒ½å®ç°è¯´æ˜

## âœ… å·²å®ŒæˆåŠŸèƒ½

### 1. ä»»åŠ¡ç®¡ç†æ¨¡å—
- âœ… ç‹¬ç«‹çš„åç«¯æœåŠ¡ï¼ˆç«¯å£ 5001ï¼‰
- âœ… å®Œæ•´çš„å¢åˆ æ”¹æŸ¥åŠŸèƒ½
- âœ… æœç´¢åŠŸèƒ½ï¼ˆæŒ‰ä»»åŠ¡åç§°ï¼‰
- âœ… ä½¿ç”¨ `tb_task_info` æ•°æ®åº“è¡¨
- âœ… é€šç”¨çš„ CRUD å®ç°ï¼ˆå¯å¤ç”¨ï¼‰

---

## ğŸ“ æ–‡ä»¶ç»“æ„

### åç«¯æ–‡ä»¶ï¼ˆBackendï¼‰
```
backend/
â”œâ”€â”€ app_task.py          # ä»»åŠ¡ç®¡ç†ä¸»ç¨‹åºï¼ˆç«¯å£ 5001ï¼‰
â”œâ”€â”€ models_task.py       # ä»»åŠ¡æ•°æ®æ¨¡å‹
â”œâ”€â”€ routes_task.py       # ä»»åŠ¡è·¯ç”±ï¼ˆå¢åˆ æ”¹æŸ¥ï¼‰
â””â”€â”€ init_task_data.py    # åˆå§‹åŒ–ä»»åŠ¡æ•°æ®è„šæœ¬
```

### å‰ç«¯æ–‡ä»¶ï¼ˆFrontendï¼‰
```
src/
â”œâ”€â”€ views/VoyageInfo/
â”‚   â””â”€â”€ task-manage.vue  # ä»»åŠ¡ç®¡ç†é¡µé¢
â””â”€â”€ api/
    â””â”€â”€ task.ts          # ä»»åŠ¡ API æ¥å£
```

---

## ğŸ—„ï¸ æ•°æ®åº“è¡¨ç»“æ„

### tb_task_infoï¼ˆä»»åŠ¡ä¿¡æ¯è¡¨ï¼‰

| å­—æ®µ | ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|------|
| task_name | VARCHAR(100) | èˆªæ¬¡ä»»åŠ¡åç§°ï¼ˆä¸»é”®ï¼‰ | ä¸œæµ·æµ·æ´‹è°ƒæŸ¥ |
| project | VARCHAR(100) | ä¸“é¡¹åç§° | æµ·æ´‹èµ„æºè°ƒæŸ¥ä¸“é¡¹ |
| task_code | VARCHAR(100) | èˆªæ¬¡ä»»åŠ¡ç¼–å· | HY2025001 |
| undertake | VARCHAR(100) | èˆªæ¬¡æ‰¿æ‹…å•ä½ | å›½å®¶æµ·æ´‹æ ‡å‡†è®¡é‡ä¸­å¿ƒ |
| participant | VARCHAR(200) | èˆªæ¬¡å‚ä¸å•ä½ | - |
| ship | VARCHAR(45) | è°ƒæŸ¥èˆ¹ | å‘é˜³çº¢01 |
| leader | VARCHAR(45) | ä»»åŠ¡è´Ÿè´£äºº | å¼ ä¸»ä»» |
| chief_scientist | VARCHAR(45) | é¦–å¸­ç§‘å­¦å®¶ | - |
| superintendent | VARCHAR(100) | éšèˆ¹ç›‘ç£å‘˜ | - |
| superintended | VARCHAR(45) | éšèˆ¹ç›‘ç£ | - |
| executiontime | TEXT | æ‰§è¡Œæ—¶é—´ | 2025-01-15 è‡³ 2025-02-20 |
| subject | VARCHAR(45) | ä»»åŠ¡å­¦ç§‘ | æµ·æ´‹åœ°è´¨ |

### åˆå§‹æ•°æ®
- ä¸œæµ·æµ·æ´‹è°ƒæŸ¥
- å—æµ·æ·±æµ·æ¢æµ‹
- æ¸¤æµ·ç¯å¢ƒç›‘æµ‹
- ï¼ˆå…¶ä»–å·²æœ‰æ•°æ®...ï¼‰

---

## ğŸ”§ åç«¯å®ç°

### 1. æ•°æ®æ¨¡å‹ï¼ˆmodels_task.pyï¼‰

```python
from flask_sqlalchemy import SQLAlchemy

db = SQLAlchemy()

class TaskInfo(db.Model):
    __tablename__ = 'tb_task_info'
    
    task_name = db.Column(db.String(100), primary_key=True)
    project = db.Column(db.String(100))
    task_code = db.Column(db.String(100))
    # ... å…¶ä»–å­—æ®µ
    
    def to_dict(self):
        return {
            'task_name': self.task_name,
            'project': self.project,
            # ...
        }
```

### 2. è·¯ç”±å®ç°ï¼ˆroutes_task.pyï¼‰

#### è·å–ä»»åŠ¡åˆ—è¡¨ï¼ˆæ”¯æŒæœç´¢ï¼‰
```python
@task_bp.route('', methods=['GET'])
def get_tasks():
    task_name = request.args.get('task_name', '')
    
    if task_name:
        tasks = TaskInfo.query.filter(
            TaskInfo.task_name.like(f'%{task_name}%')
        ).all()
    else:
        tasks = TaskInfo.query.all()
    
    return jsonify({
        'code': 200,
        'data': {
            'list': [t.to_dict() for t in tasks],
            'pageTotal': len(tasks)
        }
    })
```

#### åˆ›å»ºä»»åŠ¡
```python
@task_bp.route('', methods=['POST'])
def create_task():
    data = request.json
    
    # æ£€æŸ¥ä»»åŠ¡åç§°æ˜¯å¦å·²å­˜åœ¨
    if TaskInfo.query.filter_by(task_name=data.get('task_name')).first():
        return jsonify({'code': 400, 'message': 'ä»»åŠ¡åç§°å·²å­˜åœ¨'}), 400
    
    # åˆ›å»ºæ–°ä»»åŠ¡
    new_task = TaskInfo(**data)
    db.session.add(new_task)
    db.session.commit()
    
    return jsonify({'code': 200, 'message': 'åˆ›å»ºæˆåŠŸ'})
```

#### æ›´æ–°ä»»åŠ¡
```python
@task_bp.route('/<task_name>', methods=['PUT'])
def update_task(task_name):
    task = TaskInfo.query.filter_by(task_name=task_name).first()
    
    if not task:
        return jsonify({'code': 404, 'message': 'ä»»åŠ¡ä¸å­˜åœ¨'}), 404
    
    # æ›´æ–°å­—æ®µ
    for key, value in request.json.items():
        if hasattr(task, key):
            setattr(task, key, value)
    
    db.session.commit()
    return jsonify({'code': 200, 'message': 'æ›´æ–°æˆåŠŸ'})
```

#### åˆ é™¤ä»»åŠ¡
```python
@task_bp.route('/<task_name>', methods=['DELETE'])
def delete_task(task_name):
    task = TaskInfo.query.filter_by(task_name=task_name).first()
    
    if not task:
        return jsonify({'code': 404, 'message': 'ä»»åŠ¡ä¸å­˜åœ¨'}), 404
    
    db.session.delete(task)
    db.session.commit()
    
    return jsonify({'code': 200, 'message': 'åˆ é™¤æˆåŠŸ'})
```

### 3. ä¸»ç¨‹åºï¼ˆapp_task.pyï¼‰

```python
from flask import Flask
from flask_cors import CORS
from models_task import db
from routes_task import task_bp

app = Flask(__name__)

# æ•°æ®åº“é…ç½®
app.config['SQLALCHEMY_DATABASE_URI'] = 'mysql+pymysql://root:WASDijkl15963@localhost:3306/marine_survey_db'

# åˆå§‹åŒ–
db.init_app(app)
CORS(app)

# æ³¨å†Œè·¯ç”±
app.register_blueprint(task_bp)

if __name__ == '__main__':
    app.run(debug=True, port=5001)  # ä½¿ç”¨ 5001 ç«¯å£
```

---

## ğŸ¨ å‰ç«¯å®ç°

### 1. API æ¥å£ï¼ˆsrc/api/task.tsï¼‰

```typescript
import request from '../utils/request';

// ä½¿ç”¨ç‹¬ç«‹çš„åç«¯ç«¯å£ 5001
const taskRequest = (config: any) => {
    return request({
        ...config,
        baseURL: 'http://localhost:5001/api'
    });
};

// è·å–ä»»åŠ¡åˆ—è¡¨
export const fetchTasksNew = (params?: any) => {
    return taskRequest({
        url: '/tasks',
        method: 'get',
        params
    });
};

// åˆ›å»ºä»»åŠ¡
export const createTaskNew = (data: any) => {
    return taskRequest({
        url: '/tasks',
        method: 'post',
        data
    });
};

// æ›´æ–°ä»»åŠ¡
export const updateTaskNew = (task_name: string, data: any) => {
    return taskRequest({
        url: `/tasks/${encodeURIComponent(task_name)}`,
        method: 'put',
        data
    });
};

// åˆ é™¤ä»»åŠ¡
export const deleteTaskNew = (task_name: string) => {
    return taskRequest({
        url: `/tasks/${encodeURIComponent(task_name)}`,
        method: 'delete'
    });
};
```

### 2. ä»»åŠ¡ç®¡ç†é¡µé¢ï¼ˆsrc/views/VoyageInfo/task-manage.vueï¼‰

#### è¡¨æ ¼åˆ—å®šä¹‰
```typescript
const columns = ref([
    { type: 'index', label: 'åºå·', width: 55 },
    { prop: 'task_name', label: 'èˆªæ¬¡ä»»åŠ¡åç§°' },
    { prop: 'project', label: 'ä¸“é¡¹åç§°' },
    { prop: 'task_code', label: 'èˆªæ¬¡ä»»åŠ¡ç¼–å·' },
    { prop: 'undertake', label: 'èˆªæ¬¡æ‰¿æ‹…å•ä½' },
    { prop: 'ship', label: 'è°ƒæŸ¥èˆ¹' },
    { prop: 'leader', label: 'ä»»åŠ¡è´Ÿè´£äºº' },
    { prop: 'operator', label: 'æ“ä½œ', width: 250 },
])
```

#### è¡¨å•é…ç½®ï¼ˆåŠ¨æ€ç¦ç”¨ä¸»é”®ï¼‰
```typescript
const options = computed(() => ({
    labelWidth: '120px',
    span: 12,
    list: [
        { 
            type: 'input', 
            label: 'èˆªæ¬¡ä»»åŠ¡åç§°', 
            prop: 'task_name', 
            required: true, 
            disabled: isEdit.value  // ç¼–è¾‘æ—¶ç¦ç”¨
        },
        { type: 'input', label: 'ä¸“é¡¹åç§°', prop: 'project' },
        // ... å…¶ä»–å­—æ®µ
    ]
}))
```

#### CRUD æ“ä½œ
```typescript
// è·å–æ•°æ®
const getData = async () => {
    const params = query.task_name ? { task_name: query.task_name } : {};
    const res = await fetchTasksNew(params);
    tableData.value = res.data.data.list;
};

// æ–°å¢/æ›´æ–°
const updateData = async (formData: any) => {
    if (isEdit.value) {
        await updateTaskNew(formData.task_name, formData);
    } else {
        await createTaskNew(formData);
    }
    getData();
};

// åˆ é™¤
const handleDelete = async (row: Task) => {
    await ElMessageBox.confirm('ç¡®å®šè¦åˆ é™¤è¯¥ä»»åŠ¡å—ï¼Ÿ');
    await deleteTaskNew(row.task_name);
    getData();
};
```

---

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### 1. å¯åŠ¨åç«¯

#### ç”¨æˆ·ç®¡ç†åç«¯ï¼ˆç«¯å£ 5000ï¼‰
```bash
cd e:\OtherProoject\vue-manage-system\backend
python app.py
```

#### ä»»åŠ¡ç®¡ç†åç«¯ï¼ˆç«¯å£ 5001ï¼‰
```bash
cd e:\OtherProoject\vue-manage-system\backend
python app_task.py
```

### 2. å¯åŠ¨å‰ç«¯
```bash
cd e:\OtherProoject\vue-manage-system
npm run dev
```

### 3. è®¿é—®é¡µé¢
- å‰ç«¯ï¼š`http://localhost:5173`
- ä»»åŠ¡ç®¡ç†é¡µé¢ï¼šå¯¼èˆªåˆ°"ä»»åŠ¡ä¿¡æ¯ â†’ ä»»åŠ¡ç®¡ç†"

---

## ğŸ§ª æµ‹è¯•æŒ‡å—

### æµ‹è¯• 1ï¼šæŸ¥çœ‹ä»»åŠ¡åˆ—è¡¨
1. è®¿é—®ä»»åŠ¡ç®¡ç†é¡µé¢
2. **é¢„æœŸç»“æœ**ï¼šæ˜¾ç¤ºæ‰€æœ‰ä»»åŠ¡ï¼ˆè‡³å°‘ 5 ä¸ªï¼‰

### æµ‹è¯• 2ï¼šæœç´¢ä»»åŠ¡
1. åœ¨æœç´¢æ¡†è¾“å…¥ï¼š`ä¸œæµ·`
2. ç‚¹å‡»"æœç´¢"
3. **é¢„æœŸç»“æœ**ï¼šåªæ˜¾ç¤º"ä¸œæµ·æµ·æ´‹è°ƒæŸ¥"

### æµ‹è¯• 3ï¼šæ–°å¢ä»»åŠ¡
1. ç‚¹å‡»"æ–°å¢"æŒ‰é’®
2. å¡«å†™ï¼š
   - èˆªæ¬¡ä»»åŠ¡åç§°ï¼š`é»„æµ·ç”Ÿæ€è°ƒæŸ¥`
   - ä¸“é¡¹åç§°ï¼š`æµ·æ´‹ç”Ÿæ€ä¿æŠ¤ä¸“é¡¹`
   - èˆªæ¬¡ä»»åŠ¡ç¼–å·ï¼š`HY2025004`
   - è°ƒæŸ¥èˆ¹ï¼š`æµ·æ´‹å…­å·`
   - ä»»åŠ¡è´Ÿè´£äººï¼š`èµµåšå£«`
3. ç‚¹å‡»"ç¡®å®š"
4. **é¢„æœŸç»“æœ**ï¼šä»»åŠ¡åˆ›å»ºæˆåŠŸï¼Œåˆ—è¡¨åˆ·æ–°

### æµ‹è¯• 4ï¼šç¼–è¾‘ä»»åŠ¡
1. ç‚¹å‡»ä»»åŠ¡çš„"ç¼–è¾‘"æŒ‰é’®
2. ä¿®æ”¹"ä¸“é¡¹åç§°"
3. ç‚¹å‡»"ç¡®å®š"
4. **é¢„æœŸç»“æœ**ï¼š
   - âœ… ä»»åŠ¡åç§°ä¸å¯ä¿®æ”¹ï¼ˆç°è‰²ç¦ç”¨ï¼‰
   - âœ… å…¶ä»–å­—æ®µå¯ä»¥ä¿®æ”¹
   - âœ… æ›´æ–°æˆåŠŸ

### æµ‹è¯• 5ï¼šåˆ é™¤ä»»åŠ¡
1. ç‚¹å‡»ä»»åŠ¡çš„"åˆ é™¤"æŒ‰é’®
2. ç¡®è®¤åˆ é™¤
3. **é¢„æœŸç»“æœ**ï¼šä»»åŠ¡åˆ é™¤æˆåŠŸ

---

## ğŸ”‘ æ ¸å¿ƒç‰¹æ€§

### 1. é€šç”¨ CRUD å®ç°
æ‰€æœ‰ CRUD æ“ä½œéƒ½æ˜¯é€šç”¨çš„ï¼Œå¯ä»¥è½»æ¾å¤ç”¨åˆ°å…¶ä»–æ¨¡å—ï¼š

```python
# routes_task.py - é€šç”¨æ¨¡å¼
@bp.route('', methods=['GET'])    # æŸ¥è¯¢
@bp.route('', methods=['POST'])   # åˆ›å»º
@bp.route('/<id>', methods=['PUT'])    # æ›´æ–°
@bp.route('/<id>', methods=['DELETE']) # åˆ é™¤
```

### 2. ä¸»é”®ä¿æŠ¤
- æ–°å¢æ—¶ï¼šå¿…å¡«
- ç¼–è¾‘æ—¶ï¼šç¦ç”¨ï¼ˆé˜²æ­¢ä¿®æ”¹ä¸»é”®å¯¼è‡´æ•°æ®æ··ä¹±ï¼‰

### 3. URL ç¼–ç 
```typescript
encodeURIComponent(task_name)  // æ”¯æŒä¸­æ–‡ä»»åŠ¡å
```

### 4. ç‹¬ç«‹åç«¯æœåŠ¡
- ç”¨æˆ·ç®¡ç†ï¼š`http://localhost:5000/api`
- ä»»åŠ¡ç®¡ç†ï¼š`http://localhost:5001/api`
- ä¾¿äºæ¨¡å—åŒ–ç®¡ç†å’Œéƒ¨ç½²

---

## ğŸ“Š API æ¥å£æ–‡æ¡£

### åŸºç¡€ URL
```
http://localhost:5001/api
```

### 1. è·å–ä»»åŠ¡åˆ—è¡¨
```
GET /tasks?task_name=ä¸œæµ·
```

**å“åº”ï¼š**
```json
{
  "code": 200,
  "data": {
    "list": [
      {
        "task_name": "ä¸œæµ·æµ·æ´‹è°ƒæŸ¥",
        "project": "æµ·æ´‹èµ„æºè°ƒæŸ¥ä¸“é¡¹",
        "task_code": "HY2025001",
        ...
      }
    ],
    "pageTotal": 1
  }
}
```

### 2. åˆ›å»ºä»»åŠ¡
```
POST /tasks
Content-Type: application/json

{
  "task_name": "é»„æµ·ç”Ÿæ€è°ƒæŸ¥",
  "project": "æµ·æ´‹ç”Ÿæ€ä¿æŠ¤ä¸“é¡¹",
  ...
}
```

### 3. æ›´æ–°ä»»åŠ¡
```
PUT /tasks/ä¸œæµ·æµ·æ´‹è°ƒæŸ¥
Content-Type: application/json

{
  "project": "æ–°çš„ä¸“é¡¹åç§°"
}
```

### 4. åˆ é™¤ä»»åŠ¡
```
DELETE /tasks/ä¸œæµ·æµ·æ´‹è°ƒæŸ¥
```

---

## ğŸ”„ å¤ç”¨åˆ°å…¶ä»–æ¨¡å—

è¿™å¥— CRUD æ¨¡å¼å¯ä»¥è½»æ¾å¤ç”¨åˆ°å…¶ä»–æ¨¡å—ï¼ˆä¸“å®¶äººå‘˜ã€è®¾å¤‡ç®¡ç†ç­‰ï¼‰ï¼š

### æ­¥éª¤ï¼š
1. **å¤åˆ¶æ–‡ä»¶å¹¶é‡å‘½å**
   - `models_task.py` â†’ `models_expert.py`
   - `routes_task.py` â†’ `routes_expert.py`
   - `app_task.py` â†’ `app_expert.py`

2. **ä¿®æ”¹æ¨¡å‹å®šä¹‰**
   ```python
   class Expert(db.Model):
       __tablename__ = 'tb_expert'
       # ä¿®æ”¹å­—æ®µ
   ```

3. **ä¿®æ”¹å‰ç«¯**
   - å¤åˆ¶ `task-manage.vue` â†’ `expert-manage.vue`
   - ä¿®æ”¹è¡¨æ ¼åˆ—å’Œè¡¨å•å­—æ®µ

4. **ä¿®æ”¹ç«¯å£**
   ```python
   app.run(port=5002)  # æ–°æ¨¡å—ç”¨æ–°ç«¯å£
   ```

---

## âœ… æ€»ç»“

### å·²å®ç°åŠŸèƒ½
1. âœ… ä»»åŠ¡ç®¡ç†å®Œæ•´çš„ CRUD
2. âœ… æœç´¢åŠŸèƒ½ï¼ˆæ”¯æŒæ¨¡ç³ŠæŸ¥è¯¢ï¼‰
3. âœ… ä¸»é”®ä¿æŠ¤ï¼ˆç¼–è¾‘æ—¶ç¦ç”¨ï¼‰
4. âœ… ç‹¬ç«‹åç«¯æœåŠ¡
5. âœ… é€šç”¨çš„å®ç°æ¨¡å¼
6. âœ… ä¸­æ–‡æ”¯æŒ
7. âœ… é”™è¯¯å¤„ç†

### æŠ€æœ¯æ ˆ
- **åç«¯**ï¼šFlask + SQLAlchemy + PyMySQL
- **å‰ç«¯**ï¼šVue 3 + Element Plus + TypeScript
- **æ•°æ®åº“**ï¼šMySQLï¼ˆtb_task_info è¡¨ï¼‰

### å½“å‰è¿è¡Œçš„æœåŠ¡
- ç”¨æˆ·ç®¡ç†åç«¯ï¼šhttp://localhost:5000
- ä»»åŠ¡ç®¡ç†åç«¯ï¼šhttp://localhost:5001
- å‰ç«¯ï¼šhttp://localhost:5173

**ç°åœ¨åˆ·æ–°æµè§ˆå™¨ï¼Œè®¿é—®ä»»åŠ¡ç®¡ç†é¡µé¢è¯•è¯•å§ï¼** ğŸ‰
